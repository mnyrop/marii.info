<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />

  <title>marii¨ | continuous integration! or: jekyll gets some robot nannies.</title>
  <meta name="description" content="I’ve been making a lot of Jekyll static sites lately, and the more work I do, the more it looks like I’ll be making many more. Why? Because they’re quickly p...">

  
  <link rel="icon" href="/assets/favicon.ico" />
  

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="/notes/jekyll-ci">

  <link rel="stylesheet" href="https:///ajax/libs/highlight.js/11.7.0/styles/base16/material-palenight.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-F7LL67XEP6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-F7LL67XEP6');
</script>

</head>


  <body>
    <div style="
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      background: #0e0e0e;
      background-image: url('/assets/banner.png');
      height: 100px;
      background-size: cover;
    "></div>

    <div class="container" style="padding-top:50px">
      <div class="bio">
  <div class="bio__header">
  	<a href="/" class="no-magic"><img src="/assets/snake.png" alt="2 headed snake logo" style="width:100px;"/></a>
  </div>
  <!-- <div class="bio__desc"></div> -->
  <div class="bio__menu">
    
    <a href="/">home</a>&nbsp;
    
    <a href="/about">cv</a>&nbsp;
    
    <a href="/listening">listening</a>&nbsp;
    
    <a href="/playing">playing</a>&nbsp;
    
    <a href="/reading">reading</a>&nbsp;
    
  </div>
</div>

      <div class="post">
        <hr>
        <h1><a href="/#notes">notes</a> > Continuous Integration! Or: Jekyll gets some robot nannies.</h2>
        <p class="project__meta">
          12 September 2017
          <!-- <br>
          jekyll;ci -->
        </p>

        <div class="post__body">
          <img src="https://i.pinimg.com/736x/cf/51/2d/cf512d30b3916dd255cec4222269f216--solaris-daniel-oconnell.jpg" />
          <p>I’ve been making a lot of <strong>Jekyll static sites</strong> lately, and the more work I do, the more it looks like I’ll be making many more. Why? <strong>Because they’re quickly proving to be sustainable, extendable, and super powerful.</strong> (For more on the potential of Jekyll, check out my project <a href="/projects/wax">jekyll-wax</a>.)</p>

<p>With more sites to manage and increasingly complex components to maintain, I’ve shifted my focus to <strong>automating acceptance tests</strong> with <a href="https://www.atlassian.com/continuous-delivery/continuous-integration-intro">continuous integration</a>. In context, this means that every time I make a branch commit to my Jekyll GitHub repository:</p>

<p><br /></p>

<ol>
  <li>
    <p><a href="https://web.archive.org/web/20180324121439/https://gemnasium.com/">Gemnasium</a> will evaluate my dependencies <a href="#gemnasium"><i class="fa fa-angle-double-right" aria-hidden="true"></i></a></p>
  </li>
  <li>
    <p><a href="https://travis-ci.org">Travis-CI</a> will build my site from scratch on a virtual machine <a href="#travis"><i class="fa fa-angle-double-right" aria-hidden="true"></i></a></p>
  </li>
  <li>
    <p><a href="https://www.rubydoc.info/gems/html-proofer/1.3.0">html-proofer</a> will crawl the site for errors <a href="#html-proofer"><i class="fa fa-angle-double-right" aria-hidden="true"></i></a></p>
  </li>
  <li>
    <p><a href="https://rspec.info/">rspec</a>, <a href="https://rubygems.org/gems/capybara/versions/2.7.1">capybara</a>, and <a href="https://rubygems.org/gems/poltergeist">poltergeist</a> will perform functional unit tests.</p>
  </li>
</ol>

<p><br /></p>

<p>In other words, my Jekyll sites are now pampered. If anything emerges as a risk to their success, my CI robot nannies will intervene and let me know how to stop it.</p>

<p>I’ll talk about the first 3 parts of the process in this post, and add another post for <a href="/notes/headless-test-dynamic-search">headless testing with rspec, capybara, and poltergeist</a>, which is admittedly more difficult but completely worth it.</p>

<p><br /></p>

<p><span id="gemnasium"></span></p>
<h1 id="1-gemnasium">1. Gemnasium</h1>

<h2 id="what-is-is">What is is:</h2>

<p>If you have valid dependency lists (in the form of a <a href="https://bundler.io/gemfile.html">Gemfile</a>, a <a href="https://docs.npmjs.com/files/package.json">package.json</a> file, etc), Gemnasium will read them and give you a report on the status of your dependencies—altering you about which components are outdated, which require security updates, and so on.</p>

<h2 id="what-to-do">What to do:</h2>

<p>Get a <a href="https://web.archive.org/web/20180324121439/https://gemnasium.com/">Gemnasium account</a> and follow the steps to activate Gemnasium on your Jekyll site repository, then configure your Gemfile and other dependency files.</p>

<p><strong>Optional:</strong> If you’re like me and are <em>extra</em> lazy, you can set up Gemnasium webhooks to notify you via email or Slack.</p>

<h2 id="what-it-does">What it does:</h2>

<center><img src="/images/gemnasium.png" style="box-shadow: 2px 2px 4pc #23352a;margin-top:50px;" /></center>

<p><span id="travis"></span></p>
<h1 id="2-travis-continuous-integration-ci">2. Travis Continuous Integration (CI)</h1>

<h2 id="what-is-is-1">What is is:</h2>

<p>An automated test environment for staging code changes. It builds your application and performs tests, so you don’t have to wait to manually check your code before you commit it to your branches.</p>

<h2 id="what-to-do-1">What to do:</h2>

<p>Get a <a href="https://travis-ci.org">Travis account</a> and follow the steps to activate Gemnasium on your Jekyll site repository. Then add a <code class="language-plaintext highlighter-rouge">.travis.yml</code> file to the root of your repository, which will tell Travis what to do. To start, it should include the following:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">language</span><span class="pi">:</span> <span class="s">ruby</span>
<span class="na">rvm</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="m">2.4</span> <span class="c1"># or stable</span>
<span class="na">script</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">bundle exec jekyll build</span>
</code></pre></div></div>

<h2 id="what-it-does-1">What it does:</h2>

<p>When you commit the <code class="language-plaintext highlighter-rouge">.travis.yml</code> file (either to the <code class="language-plaintext highlighter-rouge">master</code> branch or, preferably, to a new <code class="language-plaintext highlighter-rouge">travis</code> branch), it should trigger a new Travis build that will look something like <a href="https://travis-ci.org/mnyrop/mnyrop.github.io/builds/269849238">this</a> when complete.</p>

<p><span id="html-proofer"></span></p>
<h1 id="3-html-proofer">3. html-proofer</h1>

<h2 id="what-it-is">What it is:</h2>

<p><em>HTMLProofer is a set of tests to validate your HTML output. These tests check if your image references are legitimate, if they have alt tags, if your internal links are working, and so on. It’s intended to be an all-in-one checker for your output.</em><sup> <a href="https://github.com/gjtorikian/html-proofer">1</a></sup></p>

<h2 id="what-to-do-2">What to do:</h2>

<p>Add the html-proofer gem to your <strong>Gemfile</strong>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>source "https://rubygems.org"
gem "jekyll", "3.5.2"

group :development, :test do
  gem "html-proofer"
end
</code></pre></div></div>

<p>Add the html-proofer task to your <strong>.travis.yml</strong> file:</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">language</span><span class="pi">:</span> <span class="s">ruby</span>
<span class="na">rvm</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="m">2.4</span>
<span class="na">script</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">bundle exec jekyll build</span>
  <span class="pi">-</span> <span class="s">bundle exec htmlproofer ./_site --only-4xx --check-html --allow_hash_href --assume-extension --alt-ignore '/.*/'</span>
<span class="na">env</span><span class="pi">:</span>
  <span class="na">global</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">NOKOGIRI_USE_SYSTEM_LIBRARIES=true</span> <span class="c1"># speeds up installation of html-proofer</span>
</code></pre></div></div>
<p>The htmlproofer options listed above (including <code class="language-plaintext highlighter-rouge">---only-4xx</code>, <code class="language-plaintext highlighter-rouge">--check-html</code>, <code class="language-plaintext highlighter-rouge">allow_hash_href</code>, and etc.) might not be necessary for you, but are a good starting place for Jekyll sites. For example, <code class="language-plaintext highlighter-rouge">--assume-extension</code> covers for Jekyll’s pretty permalinks (which hide their .html extensions), and <code class="language-plaintext highlighter-rouge">--check-html</code> will give you additional warnings for any unnecessary or unclosed html tags generated by your Liquid layouts.</p>

<p>When you commit these changes (e.g. to a <code class="language-plaintext highlighter-rouge">html-proofer</code> branch), Travis will trigger a new build which will (once again) test the build itself, and then proceed to check for HTML errors.</p>

<p><img src="/images/travis-build.png" style="box-shadow: 2px 2px 4pc #23352a;margin-top:30px;margin-bottom:30px;" /></p>

<p><strong>You now have a very reasonably tested Jekyll site set up for continuous integration!</strong> For a more advanced topic, continue on to the next post on <a href="/notes/headless-test-dynamic-search">headless testing with rspec, capybara, and poltergeist</a>.</p>

        </div>

        
          <div class="post__paginate">
            
              <span class="post__paginate-left">
                <a href="/notes/automate-yr-docs-mysql-to-markown-via-py">Automate docs for DB updates with Pandas + Markdown</a>
              </span>
            

            
              <span class="post__paginate-right">
                <a href="/notes/headless-test-dynamic-search">Continuous Integration II: Headless Tests w/ RSpec, Capybara, and Poltergeist</a>
              </span>
            
          </div>
        
      </div>

      
  <ul class="rows">
    <li class="row__cols">
      <div class="row__title">
        
          Notes
        
      </div>
      <div class="row__date">
          Date
      </div>
      <div class="row__cat">
        
          Tags
        
      </div>
    </li>
    
      <li class="row__post">
        <div class="row__title ">
          <a href="/notes/deploy-from-github-to-cpanel">
            Action! Automate FTP deploys from GitHub to CPanel
          </a>
        </div>
        <div class="row__date ">
          2021
        </div>
        <div class="row__cat ">actions;ci;cpanel;github;</div>
      </li>
    
      <li class="row__post">
        <div class="row__title ">
          <a href="/notes/ghostscript-for-washed-out-pdfs">
            Using Ghostscript to Covert Washed-Out PDFs to PNGs for OCR Processing
          </a>
        </div>
        <div class="row__date ">
          2020
        </div>
        <div class="row__cat ">ghostscript;ocr;bash</div>
      </li>
    
      <li class="row__post">
        <div class="row__title ">
          <a href="/notes/nycdh-2018">
            NYCDH Week Workshop: Publishing Sites with GitHub Pages
          </a>
        </div>
        <div class="row__date ">
          2018
        </div>
        <div class="row__cat ">jekyll;workshop;github;dh</div>
      </li>
    
      <li class="row__post">
        <div class="row__title ">
          <a href="/notes/static-iiif-annotations">
            Create and store static IIIF annotations Minicomp style
          </a>
        </div>
        <div class="row__date ">
          2018
        </div>
        <div class="row__cat ">jekyll;iiif;rake</div>
      </li>
    
      <li class="row__post">
        <div class="row__title ">
          <a href="/notes/govt-document-pipeline">
            Create a Gov't Document Pipeline from Scraping to Full Text OCR
          </a>
        </div>
        <div class="row__date ">
          2017
        </div>
        <div class="row__cat ">bs4;tesseract;ocr</div>
      </li>
    
      <li class="row__post">
        <div class="row__title ">
          <a href="/notes/headless-test-dynamic-search">
            Continuous Integration II: Headless Tests w/ RSpec, Capybara, and Poltergeist
          </a>
        </div>
        <div class="row__date ">
          2017
        </div>
        <div class="row__cat ">ci;rspec;capybara;poltergeist</div>
      </li>
    
      <li class="row__post">
        <div class="row__title row__active">
          <a href="/notes/jekyll-ci">
            Continuous Integration! Or: Jekyll gets some robot nannies.
          </a>
        </div>
        <div class="row__date row__active">
          2017
        </div>
        <div class="row__cat row__active">jekyll;ci</div>
      </li>
    
      <li class="row__post">
        <div class="row__title ">
          <a href="/notes/automate-yr-docs-mysql-to-markown-via-py">
            Automate docs for DB updates with Pandas + Markdown
          </a>
        </div>
        <div class="row__date ">
          2017
        </div>
        <div class="row__cat ">documentation;myql;python;markdown</div>
      </li>
    
      <li class="row__post">
        <div class="row__title ">
          <a href="/notes/the-summer-of-puppets-4">
            The Summer of Japanese Puppets, Part 4
          </a>
        </div>
        <div class="row__date ">
          2017
        </div>
        <div class="row__cat ">d3js;lunr;jekyll</div>
      </li>
    
      <li class="row__post">
        <div class="row__title ">
          <a href="/notes/the-summer-of-puppets-3">
            The Summer of Japanese Puppets, Part 3
          </a>
        </div>
        <div class="row__date ">
          2017
        </div>
        <div class="row__cat ">jekyll;github-pages;liquid</div>
      </li>
    
      <li class="row__post">
        <div class="row__title ">
          <a href="/notes/the-summer-of-puppets-2">
            The Summer of Japanese Puppets, Part 2
          </a>
        </div>
        <div class="row__date ">
          2017
        </div>
        <div class="row__cat ">jupyter;python;json;openrefine</div>
      </li>
    
      <li class="row__post">
        <div class="row__title ">
          <a href="/notes/the-summer-of-puppets">
            The Summer of Japanese Puppets, Part 1
          </a>
        </div>
        <div class="row__date ">
          2017
        </div>
        <div class="row__cat ">sql;jekyll;php</div>
      </li>
    
  </ul>


    </div>
  </body>

</html>
