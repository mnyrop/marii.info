<!DOCTYPE html>
<html lang="en" class="overscroll-none">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />

  <title>marii¨ | using ghostscript to covert washed-out pdfs for ocr processing</title>
  <meta name="description" content="I was given a batch of PDFs from a legacy journal site. The PDFs varied in length from 1 to 5 pages, included poetry and criticism (sometimes in multiple lan...">

  
  <link rel="icon" href="/assets/favicon.ico" />
  

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="/notes/ghostscript-for-washed-out-pdfs">

  <link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@11.4.0/styles/base16/material-palenight.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://unpkg.com/@tailwindcss/typography@0.2.x/dist/typography.min.css">
  <script>
    hljs.configure({ignoreUnescapedHTML: true});
    hljs.highlightAll();
  </script>
  
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-F7LL67XEP6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-F7LL67XEP6');
</script>


</head>


  <body>
    <div class="relative w-screen h-40 sm:mb-6 md:mb-8 bg-yellow-800 relative bg-fixed" style="background-image: url('/assets/banner.png')">
      <div class="container mx-auto pt-5 px-5 max-w-full">
        <a class="text-white no-magic" href="/">
          <img class="max-h-10 invert hover:invert-0" src="/assets/snake.png">
        </a>
      </div>
    </div>
    
    <div class="container mx-auto max-w-screen-lg py-10 px-5 mb-10">
      <nav class="mb-10 flex flex-wrap justify-between gap-4">
    <h1 class="flex-none">
        <a href="/" class="no-magic wavy-heading hover:text-yellow-800" style="font-size:1.75rem">Marii Nyrop</a>
    </h1>
    <div class="flex-none pt-4">
        
            <a href="/#software"
                >Software</a>
            &nbsp;
        
            <a href="/#web-and-teaching"
                >Web + Teaching</a>
            &nbsp;
        
            <a href="/#notes"
                >Notes</a>
            &nbsp;
        
            <a href="/about"
                >CV</a>
            
        
    </div>
</nav>
      <article class="prose prose-p:py-2 mb-10">
  <h2 class="prose-title">
    Using Ghostscript to Covert Washed-Out PDFs for OCR Processing
  </h2>
  <p>13 July 2020</p>
  <img src="/images/ghostscript.gif" class="pt-2" style="max-height:34rem;">
  <p>I was given a batch of PDFs from a legacy journal site. The PDFs varied in length from 1 to 5 pages, included poetry and criticism (sometimes in multiple languages), and were low in contrast—i.e., the text was medium grey on a lighter grey background. Here’s a sample, for reference:</p>

<p><br /></p>

<p><img src="/images/sample-greyscale.png" alt="excerpt for greyscale reference" /></p>

<p><br /></p>

<p>I wanted to <a href="https://tedium.co/2017/03/22/ocr-typography-optical-character-recognition-history/">OCR</a> the pdfs, but when I ran them through my general-purpose pipeline (using vanilla <a href="https://www.ghostscript.com/">Ghostscript</a> to convert the PDFs to TIFs, then using <a href="https://opensource.google/projects/tesseract">Tesseract</a> to extract text from the TIFs), the text was garbáge.</p>

<p>I looked at the generated TIFs to try and see if the problem was on the OCR side or the format conversion side. As you can see from the sample below, Tesseract never had a chance. The problem was with the conversion to TIF.</p>

<p><br /></p>

<p><img src="/images/bad-conversion.png" alt="excerpt for greyscale reference" /></p>

<p><br /></p>

<p>It took quite some time digging through Stackoverflow questions and reading Ghostscript(GS) docs before I found a working solution. There are so many ways to configure and optimize GS—it can get really overwhelming. So I thought I’d share and dissect the many parameters behind the command that eventually worked for me.</p>

<p>Without further ado, here’s the special sauce:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gs <span class="se">\</span>
  <span class="nt">-q</span> <span class="se">\</span>
  <span class="nt">-dNOPAUSE</span> <span class="se">\</span>
  <span class="nt">-dBATCH</span> <span class="se">\</span>
  <span class="nt">-sDEVICE</span><span class="o">=</span>pnggray <span class="se">\</span>
  <span class="nt">-g2550x3300</span> <span class="se">\</span>
  <span class="nt">-sOutputFile</span><span class="o">=</span><span class="nv">$png_dir</span>/%03d.png <span class="se">\</span>
  <span class="nv">$pdf</span>
</code></pre></div></div>

<p>Breaking it down line by line:</p>

<dl>
  <dt><b>gs</b></dt>
  <dd>the ghostscript invocation name</dd>

  <dt><b>-q</b></dt>
  <dd>runs the command in 'quiet mode'; optional for our purposes</dd>

  <dt><b>-dNOPAUSE</b></dt>
  <dd>disables the prompt and pause at the end of each page. (see more <a href="https://www.ghostscript.com/doc/current/Use.htm#Interaction_related_parameters">here</a>.)  
  not relevant to our problem, but you're not going to want to interact with a prompt every time you convert a file in a large batch. so you'll want to add this.</dd>

  <dt><b>-dBATCH</b></dt>
  <dd>related to <code>-dNOPAUSE</code>. if you're running this as part of a script, just use it. trust me.</dd>

  <dt><b>-sDEVICE=pnggray</b></dt>
  <dd>sets which output device Ghostscript should use, in this case, <code>pnggrey</code>. (see more <a href="https://www.ghostscript.com/doc/current/Use.htm#Output_device">here</a> and <a href="https://www.ghostscript.com/doc/current/Devices.htm#PNG">here</a>.)</dd>

  <dt><b>-g2550x3300</b></dt>
  <dd>specifies the device width and height in pixels. you'll want to adjust these for your purposes and play around as necessary. (see more <a href="https://www.ghostscript.com/doc/current/Use.htm#Parameters">here</a>.)</dd>

  <dt><b>-sOutputFile=$png_dir/%03d.png</b></dt>
  <dd>specifies which path(s) to write the resulting files to. in my case, a shell script uses a variable to <code>$png_dir</code> to streamline the placement. The file ends in <code>.png</code> because that's the conversion device i'm using and the result i want. <code>%03d</code> uses ghostscript's <code>%d</code> syntax for multipage documents, and specifically creates 001.png, 002.png, etc. as needed depending on the number of pages in the original PDF document. (the <code>03</code> specifies digit padding with zeroes)</dd>

  <dt><b>$pdf</b></dt>
  <dd>this is (absolute or relative path) to the path to the file you want to convert. in my case, <code>$pdf</code> is the variable for the path to each PDF file as globbed by my shell script. you can similarly use a variable or write out the path.</dd>
</dl>

</article>


  <div class="post__paginate border-t border-slate-900 pt-2 mt-4">
    
      <span class="post__paginate-left max-w-sm">
        <a href="/notes/deploy-from-github-to-cpanel">Action! Automate FTP deploys from GitHub to CPanel</a>
      </span>
    

    
      <span class="post__paginate-right max-w-sm">
        <a href="/notes/nycdh-2018">NYCDH Week Workshop: Publishing Sites with GitHub Pages</a>
      </span>
    
  </div>



  <ul id="notes" class="rows">
    <li class="row__cols">
      <div class="row__title">
        
          Notes
        
      </div>
      <div class="row__date">
          Date
      </div>
      <div class="row__cat">
        
          Tags
        
      </div>
    </li>
    
      <li class="row__post">
        <div class="row__title ">
          <a href="/notes/deploy-from-github-to-cpanel">
            Action! Automate FTP deploys from GitHub to CPanel
          </a>
        </div>
        <div class="row__date ">
          2021
        </div>
        <div class="row__cat ">actions;ci;cpanel;github;</div>
      </li>
    
      <li class="row__post">
        <div class="row__title row__active">
          <a href="/notes/ghostscript-for-washed-out-pdfs">
            Using Ghostscript to Covert Washed-Out PDFs for OCR Processing
          </a>
        </div>
        <div class="row__date row__active">
          2020
        </div>
        <div class="row__cat row__active">ghostscript;ocr;bash</div>
      </li>
    
      <li class="row__post">
        <div class="row__title ">
          <a href="/notes/nycdh-2018">
            NYCDH Week Workshop: Publishing Sites with GitHub Pages
          </a>
        </div>
        <div class="row__date ">
          2018
        </div>
        <div class="row__cat ">jekyll;workshop;github;dh</div>
      </li>
    
      <li class="row__post">
        <div class="row__title ">
          <a href="/notes/static-iiif-annotations">
            Create and store static IIIF annotations Minicomp style
          </a>
        </div>
        <div class="row__date ">
          2018
        </div>
        <div class="row__cat ">jekyll;iiif;rake</div>
      </li>
    
      <li class="row__post">
        <div class="row__title ">
          <a href="/notes/govt-document-pipeline">
            Create a Gov't Document Pipeline from Scraping to Full Text OCR
          </a>
        </div>
        <div class="row__date ">
          2017
        </div>
        <div class="row__cat ">bs4;tesseract;ocr</div>
      </li>
    
      <li class="row__post">
        <div class="row__title ">
          <a href="/notes/headless-test-dynamic-search">
            Continuous Integration II: Headless Tests w/ RSpec, Capybara, and Poltergeist
          </a>
        </div>
        <div class="row__date ">
          2017
        </div>
        <div class="row__cat ">ci;rspec;capybara;poltergeist</div>
      </li>
    
      <li class="row__post">
        <div class="row__title ">
          <a href="/notes/jekyll-ci">
            Continuous Integration! Or: Jekyll Gets Some Robot Nannies.
          </a>
        </div>
        <div class="row__date ">
          2017
        </div>
        <div class="row__cat ">jekyll;ci</div>
      </li>
    
      <li class="row__post">
        <div class="row__title ">
          <a href="/notes/automate-yr-docs-mysql-to-markown-via-py">
            Automate docs for DB updates with Pandas + Markdown
          </a>
        </div>
        <div class="row__date ">
          2017
        </div>
        <div class="row__cat ">documentation;myql;python;markdown</div>
      </li>
    
      <li class="row__post">
        <div class="row__title ">
          <a href="/notes/the-summer-of-puppets-4">
            The Summer of Japanese Puppets, Part 4
          </a>
        </div>
        <div class="row__date ">
          2017
        </div>
        <div class="row__cat ">d3js;lunr;jekyll</div>
      </li>
    
      <li class="row__post">
        <div class="row__title ">
          <a href="/notes/the-summer-of-puppets-3">
            The Summer of Japanese Puppets, Part 3
          </a>
        </div>
        <div class="row__date ">
          2017
        </div>
        <div class="row__cat ">jekyll;github-pages;liquid</div>
      </li>
    
      <li class="row__post">
        <div class="row__title ">
          <a href="/notes/the-summer-of-puppets-2">
            The Summer of Japanese Puppets, Part 2
          </a>
        </div>
        <div class="row__date ">
          2017
        </div>
        <div class="row__cat ">jupyter;python;json;openrefine</div>
      </li>
    
      <li class="row__post">
        <div class="row__title ">
          <a href="/notes/the-summer-of-puppets">
            The Summer of Japanese Puppets, Part 1
          </a>
        </div>
        <div class="row__date ">
          2017
        </div>
        <div class="row__cat ">sql;jekyll;php</div>
      </li>
    
  </ul>



    </div>
  </body>

</html>