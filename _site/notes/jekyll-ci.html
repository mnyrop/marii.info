<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1" />


	<title>Continuous Integration!<br>Or: Jekyll gets some robot nannies. · marii</title>


<meta name="description" content="I’ve been making a lot of Jekyll static sites lately, and the more work I do, the more it looks like I’ll be making many more. Why? Because they’re quickly p...">


<link rel="icon" href="http://localhost:8000/assets/favicon.png">
<link rel="stylesheet" href="http://localhost:8000/assets/core.css">
<link rel="canonical" href="http://localhost:8000/notes/jekyll-ci">

<script src="https://use.fontawesome.com/884e80fbb8.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-106423521-1', 'auto');
  ga('send', 'pageview');

</script>


	</head>

	<body>

		<br/><br/>

<aside class="logo">

	

	<a href="http://localhost:8000/">
		<img src="/assets/snake.png" class="gravatar">
	</a>
	<span class="logo-prompt">Home</span>

</aside>


		<main>
			<article>

	<div class="center">
		<h1>Continuous Integration!<br>Or: Jekyll gets some robot nannies.</h1>
		<p>
			
			
			
				<span style="color:#325666">#jekyll</span>&nbsp;&nbsp;
			
			
			
				<span style="color:#71909e">#continuous-integration</span>&nbsp;&nbsp;
			
			
			
				<span style="color:#325666">#travis</span>&nbsp;&nbsp;
			
			
			
				<span style="color:#71909e">#gemnasium</span>&nbsp;&nbsp;
			
			
			
				<span style="color:#325666">#html-proofer</span>
			
		</p>
		<time>September 12, 2017</time>
	</div>

	<div class="divider"></div>

	<p>I’ve been making a lot of <strong>Jekyll static sites</strong> lately, and the more work I do, the more it looks like I’ll be making many more. Why? <strong>Because they’re quickly proving to be sustainable, extendable, and super powerful.</strong> (For more on the potential of Jekyll, check out my project <a href="../projects/wax">jekyll-wax</a>.)</p>

<p>With more sites to manage and increasingly complex components to maintain, I’ve shifted my focus to <strong>automating acceptance tests</strong> with <a href="https://www.atlassian.com/continuous-delivery/continuous-integration-intro">continuous integration</a>. In context, this means that every time I make a branch commit to my Jekyll GitHub repository:</p>

<h4 id="1-gemnasium-will-evaluate-my-dependencies--2-travis-ci-will-build-my-site-from-scratch-on-a-virtual-machine---3-html-proofer-will-crawl-the-site-for-errors--and--4-rspec-capybara-and-poltergeist-will-perform-functional-unit-tests">1. <a href="http://gemnasium.com">Gemnasium</a> will evaluate my dependencies <a href="#gemnasium"><i class="fa fa-angle-double-right" aria-hidden="true"></i></a> <br />2. <a href="http://travis-ci.org">Travis-CI</a> will build my site from scratch on a virtual machine <a href="#travis"><i class="fa fa-angle-double-right" aria-hidden="true"></i></a> <br /> 3. <a href="http://www.rubydoc.info/gems/html-proofer/1.3.0">html-proofer</a> will crawl the site for errors <a href="#html-proofer"><i class="fa fa-angle-double-right" aria-hidden="true"></i></a> and <br /> 4. <a href="http://rspec.info/">rspec</a>, <a href="https://rubygems.org/gems/capybara/versions/2.7.1">capybara</a>, and <a href="https://rubygems.org/gems/poltergeist">poltergeist</a> will perform functional unit tests.</h4>

<p>In other words, my Jekyll sites are now pampered. If anything emerges as a risk to their success, my CI robot nannies will intervene and let me know how to stop it.</p>

<p>I’ll talk about the first 3 parts of the process in this post, and add another post for <a href="/notes/headless-test-dynamic-search">headless testing with rspec, capybara, and poltergeist</a>, which is admittedly more difficult but completely worth it.</p>

<center><a href="https://en.wikipedia.org/wiki/Daniel_Mr%C3%B3z"><img src="https://i.pinimg.com/736x/cf/51/2d/cf512d30b3916dd255cec4222269f216--solaris-daniel-oconnell.jpg" style="box-shadow: 2px 2px 4pc #23352a;width:500px;margin-top:50px;" /></a></center>

<p><span id="gemnasium"></span></p>
<h2 id="1-gemnasium--">1. Gemnasium  <img src="https://gemnasium.com/badges/github.com/mnyrop/mnyrop.github.io.svg" /></h2>

<h4 id="what-is-is">What is is:</h4>

<p>If you have valid dependency lists (in the form of a <a href="http://bundler.io/gemfile.html">Gemfile</a>, a <a href="https://docs.npmjs.com/files/package.json">package.json</a> file, etc), Gemnasium will read them and give you a report on the status of your dependencies—altering you about which components are outdated, which require security updates, and so on.</p>

<h4 id="what-to-do">What to do:</h4>

<p>Get a <a href="https://gemnasium.com/users/sign_up">Gemnasium account</a> and follow the steps to activate Gemnasium on your Jekyll site repository, then configure your Gemfile and other dependency files.</p>

<p><strong>Optional:</strong> If you’re like me and are <em>extra</em> lazy, you can set up Gemnasium webhooks to notify you via email or Slack.</p>

<h4 id="what-it-does">What it does:</h4>

<center><img src="/images/gemnasium.png" style="box-shadow: 2px 2px 4pc #23352a;margin-top:50px;" /></center>

<p><span id="travis"></span></p>
<h2 id="2-travis-continuous-integration-ci--">2. Travis Continuous Integration (CI)  <img src="https://travis-ci.org/mnyrop/mnyrop.github.io.svg?branch=master" /></h2>

<h4 id="what-is-is-1">What is is:</h4>

<p>An automated test environment for staging code changes. It builds your application and performs tests, so you don’t have to wait to manually check your code before you commit it to your branches.</p>

<h4 id="what-to-do-1">What to do:</h4>

<p>Get a <a href="https://travis-ci.org">Travis account</a> and follow the steps to activate Gemnasium on your Jekyll site repository. Then add a <code class="highlighter-rouge">.travis.yml</code> file to the root of your repository, which will tell Travis what to do. To start, it should include the following:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">language</span><span class="pi">:</span> <span class="s">ruby</span>
<span class="na">rvm</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">2.4</span> <span class="c1"># or stable</span>
<span class="na">script</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">bundle exec jekyll build</span>
</code></pre></div></div>

<h4 id="what-it-does-1">What it does:</h4>

<p>When you commit the <code class="highlighter-rouge">.travis.yml</code> file (either to the <code class="highlighter-rouge">master</code> branch or, preferably, to a new <code class="highlighter-rouge">travis</code> branch), it should trigger a new Travis build that will look something like <a href="https://travis-ci.org/mnyrop/mnyrop.github.io/builds/269849238">this</a> when complete.</p>

<p><span id="html-proofer"></span></p>
<h2 id="3-html-proofer">3. html-proofer</h2>

<h4 id="what-it-is">What it is:</h4>

<p><em>HTMLProofer is a set of tests to validate your HTML output. These tests check if your image references are legitimate, if they have alt tags, if your internal links are working, and so on. It’s intended to be an all-in-one checker for your output.</em><sup> <a href="https://github.com/gjtorikian/html-proofer">1</a></sup></p>

<h4 id="what-to-do-2">What to do:</h4>

<p>Add the html-proofer gem to your <strong>Gemfile</strong>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>source "https://rubygems.org"
gem "jekyll", "3.5.2"

group :development, :test do
  gem "html-proofer"
end
</code></pre></div></div>

<p>Add the html-proofer task to your <strong>.travis.yml</strong> file:</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">language</span><span class="pi">:</span> <span class="s">ruby</span>
<span class="na">rvm</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">2.4</span>
<span class="na">script</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">bundle exec jekyll build</span>
  <span class="pi">-</span> <span class="s">bundle exec htmlproofer ./_site --only-4xx --check-html --allow_hash_href --assume-extension --alt-ignore '/.*/'</span>
<span class="na">env</span><span class="pi">:</span>
  <span class="na">global</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">NOKOGIRI_USE_SYSTEM_LIBRARIES=true</span> <span class="c1"># speeds up installation of html-proofer</span>
</code></pre></div></div>
<p>The htmlproofer options listed above (including <code class="highlighter-rouge">---only-4xx</code>, <code class="highlighter-rouge">--check-html</code>, <code class="highlighter-rouge">allow_hash_href</code>, and etc.) might not be necessary for you, but are a good starting place for Jekyll sites. For example, <code class="highlighter-rouge">--assume-extension</code> covers for Jekyll’s pretty permalinks (which hide their .html extensions), and <code class="highlighter-rouge">--check-html</code> will give you additional warnings for any unnecessary or unclosed html tags generated by your Liquid layouts.</p>

<p>When you commit these changes (e.g. to a <code class="highlighter-rouge">html-proofer</code> branch), Travis will trigger a new build which will (once again) test the build itself, and then proceed to check for HTML errors.</p>

<p><img src="/images/travis-build.png" style="box-shadow: 2px 2px 4pc #23352a;margin-top:30px;margin-bottom:30px;" /></p>

<p><strong>You now have a very reasonably tested Jekyll site set up for continuous integration!</strong> For a more advanced topic, continue on to the next post on <a href="/notes/headless-test-dynamic-search">headless testing with rspec, capybara, and poltergeist</a>.</p>


</article>

<div class="page-navigation">
	
    <a class="next" href="http://localhost:8000/notes/automate-yr-docs-mysql-to-markown-via-py" title="NEXT: Peak Laziness:<br>Automate documentation for database updates with Python, Pandas and Markdown">&lt;&lt;</a>
		<span> &middot; </span>
  
		<a class="home" href="http://localhost:8000/" title="Back to Homepage">Home</a>
  
		<span> &middot; </span>
    <a class="prev" href="http://localhost:8000/notes/headless-test-dynamic-search" title="PREV: Continuous Integration II:<br>Headless Tests for Jekyll with RSpec, Capybara, and Poltergeist">&gt;&gt;</a>
  
</div>

		</main>

		<div class="footer">
  <br><br><br><br>
  <button>
    <a href="https://twitter.com/mariinyrop" target="_none">
      <i class="fa fa-lg fa-twitter" aria-hidden="true"></i>
    </a>
  </button>
  &nbsp;&nbsp;
  <button>
    <a href="https://github.com/mnyrop" target="_none">
      <i class="fa fa-lg fa-code-fork" aria-hidden="true"></i>
    </a>
  </button>
  &nbsp;&nbsp;
  <button id="btn" data-clipboard-text="m.nyrop@columbia.edu">
    <i class="fa fa-lg fa-envelope-o" aria-hidden="true"></i>
  </button>
  &nbsp;&nbsp;
  <button>
    <a href="https://stackoverflow.com/users/8227741/marii" target="_none">
      <i class="fa fa-lg fa-stack-overflow" aria-hidden="true"></i>
    </a>
  </button>
  &nbsp;&nbsp;
  <button>
    <a href="https://jsfiddle.net/user/marii_/fiddles/" target="_none">
      <i class="fa fa-lg fa-jsfiddle" aria-hidden="true"></i>
    </a>
  </button>
  &nbsp;&nbsp;
  <button>
    <a href="https://rubygems.org/profiles/marii" target="_none">
      <i class="fa fa-lg fa-diamond" aria-hidden="true"></i>
    </a>
  </button>
  &nbsp;&nbsp;
  <!-- <button>
    <a href="/shelf">
      <i class="fa fa-lg fa-book" aria-hidden="true"></i>
    </a>
  </button> -->
  <br><br>
  <br><br><br>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.10/clipboard.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
<style>
  .tooltip{position:absolute;z-index:1030;display:block;font-size:12px;line-height:1.4;opacity:0;filter:alpha(opacity=0);visibility:visible}.tooltip.in{opacity:.9;filter:alpha(opacity=90)}.tooltip.top{padding:5px 0;margin-top:-3px}.tooltip.right{padding:0 5px;margin-left:3px}.tooltip.bottom{padding:5px 0;margin-top:3px}.tooltip.left{padding:0 5px;margin-left:-3px}.tooltip-inner{max-width:200px;padding:3px 8px;color:#fff;text-align:center;text-decoration:none;background-color:#000;border-radius:4px}.tooltip-arrow{position:absolute;width:0;height:0;border-color:transparent;border-style:solid}.tooltip.top .tooltip-arrow{bottom:0;left:50%;margin-left:-5px;border-top-color:#000;border-width:5px 5px 0}.tooltip.top-left .tooltip-arrow{bottom:0;left:5px;border-top-color:#000;border-width:5px 5px 0}.tooltip.top-right .tooltip-arrow{right:5px;bottom:0;border-top-color:#000;border-width:5px 5px 0}.tooltip.right .tooltip-arrow{top:50%;left:0;margin-top:-5px;border-right-color:#000;border-width:5px 5px 5px 0}.tooltip.left .tooltip-arrow{top:50%;right:0;margin-top:-5px;border-left-color:#000;border-width:5px 0 5px 5px}.tooltip.bottom .tooltip-arrow{top:0;left:50%;margin-left:-5px;border-bottom-color:#000;border-width:0 5px 5px}.tooltip.bottom-left .tooltip-arrow{top:0;left:5px;border-bottom-color:#000;border-width:0 5px 5px}.tooltip.bottom-right .tooltip-arrow{top:0;right:5px;border-bottom-color:#000;border-width:0 5px 5px}
</style>
<script>
  $('#btn').tooltip({
    trigger: 'click',
    placement: 'bottom'
  });
  function setTooltip(message) {
    $('#btn').tooltip('hide')
      .attr('data-original-title', message)
      .tooltip('show');
  }
  function hideTooltip() {
    setTimeout(function() {
      $('button').tooltip('hide');
    }, 1000);
  }
  // Clipboard
  var clipboard = new Clipboard('button');
  clipboard.on('success', function(e) {
    setTooltip('Copied to clipboard!');
    hideTooltip();
  });
  clipboard.on('error', function(e) {
    setTooltip('Failed!');
    hideTooltip();
  });
</script>


	</body>

</html>
